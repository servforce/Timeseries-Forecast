
services:
  chronos-service:
    container_name: chronos_forecast
    build:
      context: .              
      dockerfile: server/Dockerfile
    ports:
      - "5001:5001"           # 端口映射
    volumes:
      # -------------------------------------------------------
      # 核心挂载点：直接挂载父目录 chronos_models
      # 这会自动包含您提到的两个路径：
      #   1. server/app/models/chronos_models/finetuned
      #   2. server/app/models/chronos_models/unfinetuned
      # -------------------------------------------------------
      - ./server/app/models/chronos_models:/app/server/app/models/chronos_models
      
      # (可选) 挂载微调服务生成的临时目录或日志，视需求而定
      # - ./server/logs:/app/server/logs

    environment:
      - APP_NAME=Chronos_Forecast_Service
      - ENVIRONMENT=prod
      - LOG_LEVEL=info
      # 容器内代码会自动去 /app/server/app/models/chronos_models 下找模型
      # 无需额外设置路径环境变量，除非您的代码逻辑有变

    restart: unless-stopped
    # 如果您需要使用 GPU 且已安装 nvidia-container-toolkit，请取消下方注释
    # deploy:
    #   resources:
    #     reservations:
    #       devices:
    #         - driver: nvidia
    #           count: 1
    #           capabilities: [gpu]